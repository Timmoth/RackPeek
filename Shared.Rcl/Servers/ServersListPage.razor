@page "/servers/list"
@using RackPeek.Domain.Resources.Hardware.Servers
@inject IGetAllResourcesByKindUseCase<Server> GetAllUseCase
@inject IGetResourceByNameUseCase<Server> GetByNameUseCase
@inject NavigationManager Nav

<PageTitle>Servers</PageTitle>

<h1 class="text-lg text-zinc-100"
    data-testid="servers-page-title">
    Servers
</h1>

<div class="min-h-screen bg-zinc-950 text-zinc-200 font-mono p-6 space-y-6"
     data-testid="servers-page-root">

    <!-- Add Server -->
    <div data-testid="add-server-section">
        <AddResourceComponent TResource="Server"
                              Placeholder="name"
                              OnCreated="NavigateToNewResource"
                              />
    </div>

    @if (_servers is null)
    {
        <div class="text-zinc-500"
             data-testid="servers-loading">
            loading servers…
        </div>
    }
    else if (_servers.Count == 0)
    {
        <div class="text-zinc-500"
             data-testid="servers-empty">
            no servers found
        </div>
    }
    else
    {
        <div class="space-y-4"
             data-testid="servers-list">

            @foreach (var server in _servers.OrderBy(s => s.Name))
            {
                    <ServerCardComponent Server="server"
                                         OnDeleted="Callback" />
            }

        </div>
    }
</div>

@code {
    private IReadOnlyList<Server>? _servers;

    protected override async Task OnInitializedAsync()
    {
        _servers = await GetAllUseCase.ExecuteAsync();
    }

    private Task NavigateToNewResource(string serverName)
    {
        Nav.NavigateTo($"resources/hardware/{serverName}");
        return Task.CompletedTask;
    }

    private async Task Callback(string obj)
    {
        _servers = await GetAllUseCase.ExecuteAsync();
    }
}